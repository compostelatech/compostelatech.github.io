<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'/>
  <link href='vendor/gcalendar/css/fullcalendar.min.css' rel='stylesheet'/>
  <link href='vendor/gcalendar/css/fullcalendar.vigotech.css' rel='stylesheet'/>
  <link href='vendor/gcalendar/css/fullcalendar.print.min.css' rel='stylesheet' media='print'/>

  <script src='vendor/gcalendar/js/lib/moment.min.js'></script>
  <script src='vendor/gcalendar/js/lib/jquery.min.js'></script>
  <script src='vendor/gcalendar/js/fullcalendar.min.js'></script>
  <script src='vendor/gcalendar/js/gcal.min.js'></script>
  <script src='vendor/gcalendar/js/locale-all.js'></script>

  <script>

    $(document).ready(function () {

      var myFullCalendar = $('#calendar').fullCalendar({

        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'month,agendaWeek,listMonth'
        },

        displayEventTime: false, // don't show the time column in list view

        googleCalendarApiKey: 'AIzaSyDR6fx3vTb9vE7jm30YN8FrYFehPVthWGQ',

        events: {
          googleCalendarId: 'compostelatech.org_nfp71mi362ku9p3t8su7b199nc@group.calendar.google.com'
        }, //CalendarId
        locale: 'gl',

        eventClick: function (event) {
          // opens events in a popup window
          window.open(event.url, 'gcalevent', 'width=700,height=600');
          return false;
        },

        loading: function (bool) {
          $('#loading').toggle(bool);
          if (!bool) {
            resizeCalendar();
          }
        },
        windowResize: function(view) {
          resizeCalendar();
        },
        eventAfterAllRender:function(view) {
          loadedCalendar();
        }
      });

    });
    function loadedCalendar() {

          var arrayEvents = $('#calendar').fullCalendar('clientEvents');
         if (arrayEvents) {
            var arrayEventsCounter = 0;
            
            
            window.parent.$('#carouselExampleIndicators .carousel-inner .container-next-event > .carousel-item').remove();
            arrayEvents.forEach(function(event) {
              var date_event = new Date(event.start);
              
              var year_event = date_event.getFullYear();
              var day_event = date_event.getDate();
              day_event = (day_event < 10 ? "0" : "") + day_event;
              var month_event = date_event.getMonth() + 1;
              month_event = (month_event < 10 ? "0" : "") + month_event;
              var hour_event = date_event.getHours();
              hour_event = (hour_event < 10 ? "0" : "") + hour_event;
              var min_event = date_event.getMinutes();
              min_event = (min_event < 10 ? "0" : "") + min_event;
              var date_event_start_date_string = day_event + "/" + month_event + "/" + year_event;
              var date_event_start_time_string = hour_event + ":" + min_event;
              var tempHTML;
              if (arrayEventsCounter == 0) tempHTML = '<div class="carousel-item active">';
              else tempHTML = '<div class="carousel-item">';
                tempHTML += '<div class="next-event-content">';
                  tempHTML += '<div class="next-event-logo">';
                  tempHTML += '</div>';
                  tempHTML += '<div class="next-event-info">';
                    tempHTML += '<a target="_blank" href="' + event.url + '">';
                      //tempHTML += '<h6>Grupo inventao</h6>';
                      tempHTML += '<h5>' + event.title + '</h5>';
                      if (event.description) tempHTML += '<span class="description"> ' + event.description +'</span><br/><br/>';
                      tempHTML += '<span class="datetime"><i class="fa fa-calendar-alt"></i> ' + date_event_start_date_string;
                      if (!event.allDay) tempHTML += ' <i class="fa fa-clock"></i> ' + date_event_start_time_string;
                      tempHTML += '</span>';
                      tempHTML += '<br/>';
                      if (event.location) tempHTML += '<span><i class="fa fa-map-marker-alt"></i> ' + event.location +'</span><br/>';
                      tempHTML += '<span class="btn">MÃ¡is info</span>';
                    tempHTML += '</a>';  
                  tempHTML += '</div>';
                tempHTML += '</div>';
              tempHTML += '</div>';
              // adding carousel item
              window.parent.$('#carouselExampleIndicators .carousel-inner .container-next-event').append(tempHTML);
              // adding carousel indicator
              if (arrayEventsCounter > 0) window.parent.$('#carouselExampleIndicators ol.carousel-indicators').append('<li data-target="#carouselExampleIndicators" data-slide-to="' + arrayEventsCounter + '" class=""></li>');
              else window.parent.$('#carouselExampleIndicators ol.carousel-indicators').append('<li data-target="#carouselExampleIndicators" data-slide-to="' + arrayEventsCounter + '" class="active"></li>');

              //console.log(event);
              arrayEventsCounter++;
            });
            //window.parent.$("#carouselExampleIndicators").carousel("pause").removeData();
            window.parent.$("#loading_carouselExampleIndicators").hide();
            window.parent.$("#carouselExampleIndicators").show();
             window.parent.$("#carouselExampleIndicators").carousel();

         }
    }
    function resizeCalendar() {
      if ($(window).width() < 600) {
        $('#calendar').fullCalendar('changeView', 'listMonth');
      }
    }

  </script>
  <style>

    body {
      background-color: #ffffff;
      margin: 40px 10px;
      padding: 0;
      font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
      font-size: 14px;
    }

    #loading {
      display: none;
      position: absolute;
      top: 10px;
      right: 10px;
    }

    #calendar {
      max-width: 900px;
      margin: 0 auto;
    }
    @media (max-width: 768px) {
        .fc-toolbar .fc-left,
        .fc-toolbar .fc-right {
          float: none;
          display: flex;
          justify-content: center;
          margin-bottom:20px;
        }
    }
  </style>
</head>
<body>

<div id='loading'>loading...</div>

<div id='calendar'></div>

</body>
</html>
